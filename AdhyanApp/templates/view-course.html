{% load static %}
{% include 'header.html' %}

<style>
    body {
        display: block;
        margin: 8px;
    }
    {% comment %} #show-pdf-button{
        width: 150px;
        display: block;
        margin: 20px auto;
    } {% endcomment %}
    #pdf-main-container {
        width: 400px;
        margin: 20px auto;
    }
    #pdf-loader {
        display: none;
        text-align: center;
        color: #999999;
        font-size: 13px;
        line-height: 100px;
        height: 100px;
    }
    #pdf-meta {
        overflow: hidden;
        margin: 0 0 20px 0;
    }
    #pdf-buttons {
        float: left;
    }
    #page-count-container {
        float: right;
    }
    #pdf-current-page, #pdf-total-pages {
        display: inline;
    }
    #pdf-canvas {
        border: 0px solid rgba(0,0,0,0.2);
        box-sizing: border-box;
        height: 817px;
        width: 600px;
        
    }
    #page-loader {
        height: 100px;
        line-height: 100px;
        text-align: center;
        display: none;
        color: #999999;
        font-size: 13px;
    }
    
  </style>

    <!--== BODY CONTNAINER ==-->
    <div class="container-fluid sb2" style="margin-top:0px;">
        <div class="row">
            <div class="sb2-1">
                
                <!--== LEFT MENU ==-->
                <div class="sb2-13">
                    <ul class="collapsible" data-collapsible="accordion">
                        {% for i in index %}                        
                        <li><a href="#pdf-canvas" id="show-pdf-button" class="collapsible-header"><i class="fa fa-book" aria-hidden="true"></i> {{i.topic}}</a> 
                        
                        {% comment %} <li><a href=>{{i.material.url}}</a></li> {% endcomment %}
                                                   
                        </li>
                        {% endfor %}                        
                    </ul>
                </div>
            </div>

            <!--== BODY INNER CONTAINER ==-->
            <div class="sb2-2" style="">
                <!--== breadcrumbs ==-->
                {% comment %} <div class="sb2-2-2">
                    <ul>
                        <li><a href="index-2.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                        </li>
                        <li class="active-bre"><a href="#"> Add new course</a>
                        </li>
                        <li class="page-back"><a href="index-2.html"><i class="fa fa-backward" aria-hidden="true"></i> Back</a>
                        </li>
                    </ul>
                </div> {% endcomment %}

                <!--== User Details ==-->
                <div class="sb2-2-3">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box-inn-sp admin-form">
                                <div class="sb2-2-add-blog sb2-2-1">  
                                    <div style="margin-right:200px;"> 
                                        {% comment %} <button id="show-pdf-button">Show PDF</button>  {% endcomment %}

                                        <div id="pdf-main-container">
                                            <div id="pdf-loader">Loading document ...</div>
                                            <div id="pdf-contents">
                                                <div id="pdf-meta">
                                                    <div id="pdf-buttons" style="margin-left:100px;">
                                                        <button id="pdf-prev">Previous</button>
                                                        <button id="pdf-next">Next</button>
                                                    </div>
                                                    <div id="page-count-container">Page <div id="pdf-current-page"></div> of <div id="pdf-total-pages"></div></div>
                                                </div>
                                                <canvas id="pdf-canvas" width="400"></canvas>
                                                <div id="page-loader">Loading page ...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>

        </div>
    </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.228/pdf.min.js"></script>
  <script src="js/pdf.js"></script>
  <script src="js/pdf.worker.js"></script>


  <script>
    var _PDF_DOC,
_CURRENT_PAGE,
_TOTAL_PAGES,
_PAGE_RENDERING_IN_PROGRESS = 0,
_CANVAS = document.querySelector('#pdf-canvas');

// initialize and load the PDF
async function showPDF(pdf_url) {
document.querySelector("#pdf-loader").style.display = 'block';

// get handle of pdf document
try {
    _PDF_DOC = await pdfjsLib.getDocument({ url: pdf_url });
}
catch(error) {
    alert(error.message);
}

// total pages in pdf
_TOTAL_PAGES = _PDF_DOC.numPages;

// Hide the pdf loader and show pdf container
document.querySelector("#pdf-loader").style.display = 'none';
document.querySelector("#pdf-contents").style.display = 'block';
document.querySelector("#pdf-total-pages").innerHTML = _TOTAL_PAGES;

// show the first page
showPage(1);
}

// load and render specific page of the PDF
async function showPage(page_no) {
_PAGE_RENDERING_IN_PROGRESS = 1;
_CURRENT_PAGE = page_no;

// disable Previous & Next buttons while page is being loaded
document.querySelector("#pdf-next").disabled = true;
document.querySelector("#pdf-prev").disabled = true;

// while page is being rendered hide the canvas and show a loading message
document.querySelector("#pdf-canvas").style.display = 'none';
document.querySelector("#page-loader").style.display = 'block';

// update current page
document.querySelector("#pdf-current-page").innerHTML = page_no;

// get handle of page
try {
    var page = await _PDF_DOC.getPage(page_no);
}
catch(error) {
    alert(error.message);
}

// original width of the pdf page at scale 1
var pdf_original_width = page.getViewport(1).width;

// as the canvas is of a fixed width we need to adjust the scale of the viewport where page is rendered
var scale_required = _CANVAS.width / pdf_original_width;

// get viewport to render the page at required scale
var viewport = page.getViewport(scale_required);

// set canvas height same as viewport height
_CANVAS.height = viewport.height;

// setting page loader height for smooth experience
document.querySelector("#page-loader").style.height =  _CANVAS.height + 'px';
document.querySelector("#page-loader").style.lineHeight = _CANVAS.height + 'px';

var render_context = {
    canvasContext: _CANVAS.getContext('2d'),
    viewport: viewport
};
    
// render the page contents in the canvas
try {
    await page.render(render_context);
}
catch(error) {
    alert(error.message);
}

_PAGE_RENDERING_IN_PROGRESS = 0;

// re-enable Previous & Next buttons
document.querySelector("#pdf-next").disabled = false;
document.querySelector("#pdf-prev").disabled = false;

// show the canvas and hide the page loader
document.querySelector("#pdf-canvas").style.display = 'block';
document.querySelector("#page-loader").style.display = 'none';
}

// click on "Show PDF" buuton
document.querySelector("#show-pdf-button").addEventListener('click', function() {
this.style.display = 'none';
showPDF("https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf");
});

// click on the "Previous" page button
document.querySelector("#pdf-prev").addEventListener('click', function() {
if(_CURRENT_PAGE != 1)
    showPage(--_CURRENT_PAGE);
});

// click on the "Next" page button
document.querySelector("#pdf-next").addEventListener('click', function() {
if(_CURRENT_PAGE != _TOTAL_PAGES)
    showPage(++_CURRENT_PAGE);
});
</script>